ğŸ“Œ Rutas / Tablas / Vistas que usa el sistema para conectarse a la base de datos

A continuaciÃ³n te dejo una lista clara y agrupada por mÃ³dulos, para que siempre recuerdes quÃ© estÃ¡s usando en Supabase.

1ï¸âƒ£ AutenticaciÃ³n (Supabase Auth)

Tu frontend usa:

const { data: authData } = await supabase.auth.getUser();
const user = authData.user;


Por lo tanto dependemos de:

ğŸ”¹ supabase.auth.users

Campos importantes:

id (UUID del usuario)

email

user_metadata (nombre, rol, sistema_asignado, home_tab, etc.)

2ï¸âƒ£ Cotizaciones (principales)
ğŸŸ¦ Tabla: cotizaciones_aprobacion

Es la tabla core de todo el sistema.

Campos que usamos:

id

cliente_id

sistema_id

items (jsonb)

consumos (jsonb)

consumo_stats (jsonb)

estado

vendedor_uid

vendedor_nombre

codigo

monto

fecha

comentario_rechazo

supervisor_id

supervisor_nombre

fecha_autorizacion

created_by

ğŸŸ© Vista: v_cotizaciones_autorizacion

Usada por:

Autorizaciones.jsx

AprobacionCoti.jsx (supervisor)

MisCotizaciones.jsx (vendedor filtrado)

La vista devuelve:

âœ” datos del cliente
âœ” datos de consumo
âœ” datos del sistema propuesto
âœ” items
âœ” vendedor
âœ” cÃ³digo
âœ” estado
âœ” monto
âœ” fecha

3ï¸âƒ£ CatÃ¡logo de productos

El vendedor carga Ã­tems desde la vista consolidada:

ğŸŸ§ Vista: v_catalogo_items

Une paneles + componentes_sistema.

Campos:

tipo_item

item_id

nombre

precio

moneda

categoria

sistema_id

potencia_kw

potencia_watts

detalle

Usada por:
âœ” FormCotizacionCliente.jsx
âœ” CalculadoraProm.jsx
âœ” EditarCotizacion.jsx

4ï¸âƒ£ Paneles y componentes
ğŸŸ¦ Tabla: paneles

Campos:

id

marca

potencia_watts

tipo

precio

moneda

Usada en:
âœ” Autorizaciones.jsx para recuperar precio real por refid
âœ” Vista v_catalogo_items

ğŸŸ¨ Tabla: componentes_sistema

Campos:

id

sistema_id

nombre_componente

categoria

precio

moneda

potencia_kw

detalles

Usada en:
âœ” Autorizaciones.jsx
âœ” Vista v_catalogo_items

ğŸŸ© Tabla: sistemas_solares

Campos:

id

nombre

descripcion

tipo

otros detalles

Usada en:
âœ” Autorizaciones.jsx
âœ” Vista v_cotizaciones_autorizacion
âœ” FormCotizacionCliente.jsx

5ï¸âƒ£ Clientes & consumos
ğŸŸ¦ Tabla: clientes

Campos:

id

nombre_completo

correo

telefono

pais

departamento

municipio

direccion

hsp

Usada en:
âœ” FormularioCliente.jsx
âœ” Vista v_cotizaciones_autorizacion

ğŸŸ§ Tabla: cliente_consumos

Registra los consumos histÃ³ricos por cliente.

Usada en:
âœ” Promedios en el vendedor
âœ” Vista y cÃ¡lculo en v_cotizaciones_autorizacion

6ï¸âƒ£ Rutas lÃ³gicas del frontend (empresa Nimbus Solar)

Todas las operaciones a Supabase se hacen vÃ­a:

supabase.from("nombre_tabla")
supabase.from("nombre_vista")


Y especÃ­ficamente usamos rutas como:

ğŸ”¹ Obtener cotizaciones para supervisor
supabase
  .from("v_cotizaciones_autorizacion")
  .select("*")
  .in("estado", ["pendiente", "enviada"])

ğŸ”¹ Actualizar estado
supabase
  .from("cotizaciones_aprobacion")
  .update(payload)
  .eq("id", editRow.id)

ğŸ”¹ Cargar catÃ¡logo
supabase
  .from("v_catalogo_items")
  .select("*")
  .order("categoria")

ğŸ”¹ Cargar precios de paneles
supabase.from("paneles").select("id, precio")

ğŸ”¹ Cargar precios de componentes
supabase.from("componentes_sistema").select("id, precio")

7ï¸âƒ£ Nuevas estructuras creadas para este mÃ³dulo

Estas vistas fueron creadas recientemente:

ğŸ§© v_cotizaciones_autorizacion

Usada para el supervisor.

ğŸ§© v_catalogo_items

Usada para traer paneles y componentes desde un mismo catÃ¡logo.

