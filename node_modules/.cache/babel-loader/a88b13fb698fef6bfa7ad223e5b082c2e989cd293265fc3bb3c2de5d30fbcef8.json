{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\garci\\\\Downloads\\\\nimbus-login-app\\\\src\\\\componentes\\\\contabilidad\\\\PrecioTrabajos.jsx\",\n  _s = $RefreshSig$();\nimport { useState, useEffect } from \"react\";\nimport { supabase } from '../../supabase';\nimport { Pencil, Save } from \"lucide-react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PrecioTrabajos() {\n  _s();\n  const [proyectos, setProyectos] = useState([]);\n  const [proyectoSeleccionado, setProyectoSeleccionado] = useState(null);\n  const [trabajos, setTrabajos] = useState([]);\n  useEffect(() => {\n    const obtenerProyectos = async () => {\n      const {\n        data,\n        error\n      } = await supabase.from(\"proyectos\").select(\"*\");\n      if (error) console.error(\"Error al obtener proyectos:\", error);else setProyectos(data);\n    };\n    obtenerProyectos();\n  }, []);\n  const cargarTrabajos = async idProyecto => {\n    // Obtener trabajos de este proyecto\n    const {\n      data: trabajosData,\n      error\n    } = await supabase.from(\"trabajos_proyecto\").select(\"*\").eq(\"proyecto_id\", idProyecto);\n    if (error) {\n      console.error(\"Error al obtener trabajos:\", error);\n      return;\n    }\n\n    // Calcular unidades instaladas por trabajo (con reportes)\n    const trabajosConDatos = await Promise.all(trabajosData.map(async trabajo => {\n      const {\n        data: reportes,\n        error: errorReportes\n      } = await supabase.from(\"reportes_diarios\").select(\"cantidad_instalada\").eq(\"proyecto_id\", idProyecto).eq(\"nombre_trabajo\", trabajo.nombre_trabajo);\n      if (errorReportes) {\n        console.error(\"Error al obtener reportes:\", errorReportes);\n        return trabajo;\n      }\n      const unidadesInstaladas = reportes ? reportes.reduce((sum, r) => sum + (r.cantidad_instalada || 0), 0) : 0;\n      return {\n        ...trabajo,\n        unidades_instaladas: unidadesInstaladas,\n        total_a_instalar: trabajo.unidades_a_instalar * trabajo.precio_unitario,\n        total_instalado: unidadesInstaladas * trabajo.precio_unitario\n      };\n    }));\n    setTrabajos(trabajosConDatos);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"text-xl font-bold text-purple-600\",\n      children: \"\\uD83D\\uDCB0 Precios por Proyecto\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"mr-2 font-medium\",\n        children: \"Seleccione un proyecto:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        value: proyectoSeleccionado || \"\",\n        onChange: e => {\n          const id = e.target.value;\n          setProyectoSeleccionado(id);\n          if (id) cargarTrabajos(id);else setTrabajos([]);\n        },\n        className: \"border p-1 rounded\",\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          children: \"-- Seleccione --\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 11\n        }, this), proyectos.map(proyecto => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: proyecto.id,\n          children: proyecto.nombre\n        }, proyecto.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 68,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-4\",\n      children: [trabajos.map(trabajo => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"border-b py-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"font-bold text-gray-700\",\n          children: trabajo.nombre_trabajo\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"\\uD83D\\uDD39 Unidades a Instalar: \", trabajo.unidades_a_instalar]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"\\uD83D\\uDD39 Precio por Unidad: Q\", trabajo.precio_unitario.toFixed(2)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"\\uD83D\\uDD39 Total a Instalar: Q\", trabajo.total_a_instalar.toFixed(2)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"\\uD83D\\uDD39 Unidades Instaladas: \", trabajo.unidades_instaladas]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"\\uD83D\\uDD39 Total Instalado: Q\", trabajo.total_instalado.toFixed(2)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 13\n        }, this)]\n      }, trabajo.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 11\n      }, this)), trabajos.length === 0 && proyectoSeleccionado && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-4 text-gray-500\",\n        children: \"No hay trabajos asociados a este proyecto.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 62,\n    columnNumber: 5\n  }, this);\n}\n_s(PrecioTrabajos, \"kleMFQSWKbZ4o1+CNgCJ2bJFD8s=\");\n_c = PrecioTrabajos;\nvar _c;\n$RefreshReg$(_c, \"PrecioTrabajos\");","map":{"version":3,"names":["useState","useEffect","supabase","Pencil","Save","jsxDEV","_jsxDEV","PrecioTrabajos","_s","proyectos","setProyectos","proyectoSeleccionado","setProyectoSeleccionado","trabajos","setTrabajos","obtenerProyectos","data","error","from","select","console","cargarTrabajos","idProyecto","trabajosData","eq","trabajosConDatos","Promise","all","map","trabajo","reportes","errorReportes","nombre_trabajo","unidadesInstaladas","reduce","sum","r","cantidad_instalada","unidades_instaladas","total_a_instalar","unidades_a_instalar","precio_unitario","total_instalado","className","children","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","e","id","target","proyecto","nombre","toFixed","length","_c","$RefreshReg$"],"sources":["C:/Users/garci/Downloads/nimbus-login-app/src/componentes/contabilidad/PrecioTrabajos.jsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { supabase } from '../../supabase'\r\nimport { Pencil, Save } from \"lucide-react\";\r\n\r\nexport default function PrecioTrabajos() {\r\n  const [proyectos, setProyectos] = useState([]);\r\n  const [proyectoSeleccionado, setProyectoSeleccionado] = useState(null);\r\n  const [trabajos, setTrabajos] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const obtenerProyectos = async () => {\r\n      const { data, error } = await supabase.from(\"proyectos\").select(\"*\");\r\n      if (error) console.error(\"Error al obtener proyectos:\", error);\r\n      else setProyectos(data);\r\n    };\r\n    obtenerProyectos();\r\n  }, []);\r\n\r\n  const cargarTrabajos = async (idProyecto) => {\r\n    // Obtener trabajos de este proyecto\r\n    const { data: trabajosData, error } = await supabase\r\n      .from(\"trabajos_proyecto\")\r\n      .select(\"*\")\r\n      .eq(\"proyecto_id\", idProyecto);\r\n\r\n    if (error) {\r\n      console.error(\"Error al obtener trabajos:\", error);\r\n      return;\r\n    }\r\n\r\n    // Calcular unidades instaladas por trabajo (con reportes)\r\n    const trabajosConDatos = await Promise.all(\r\n      trabajosData.map(async (trabajo) => {\r\n        const { data: reportes, error: errorReportes } = await supabase\r\n          .from(\"reportes_diarios\")\r\n          .select(\"cantidad_instalada\")\r\n          .eq(\"proyecto_id\", idProyecto)\r\n          .eq(\"nombre_trabajo\", trabajo.nombre_trabajo);\r\n\r\n        if (errorReportes) {\r\n          console.error(\"Error al obtener reportes:\", errorReportes);\r\n          return trabajo;\r\n        }\r\n\r\n        const unidadesInstaladas = reportes\r\n          ? reportes.reduce((sum, r) => sum + (r.cantidad_instalada || 0), 0)\r\n          : 0;\r\n\r\n        return {\r\n          ...trabajo,\r\n          unidades_instaladas: unidadesInstaladas,\r\n          total_a_instalar: trabajo.unidades_a_instalar * trabajo.precio_unitario,\r\n          total_instalado: unidadesInstaladas * trabajo.precio_unitario,\r\n        };\r\n      })\r\n    );\r\n\r\n    setTrabajos(trabajosConDatos);\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-4\">\r\n      <h2 className=\"text-xl font-bold text-purple-600\">ðŸ’° Precios por Proyecto</h2>\r\n\r\n      {/* Selector de proyecto */}\r\n      <div className=\"mt-2\">\r\n        <label className=\"mr-2 font-medium\">Seleccione un proyecto:</label>\r\n        <select\r\n          value={proyectoSeleccionado || \"\"}\r\n          onChange={(e) => {\r\n            const id = e.target.value;\r\n            setProyectoSeleccionado(id);\r\n            if (id) cargarTrabajos(id);\r\n            else setTrabajos([]);\r\n          }}\r\n          className=\"border p-1 rounded\"\r\n        >\r\n          <option value=\"\">-- Seleccione --</option>\r\n          {proyectos.map((proyecto) => (\r\n            <option key={proyecto.id} value={proyecto.id}>\r\n              {proyecto.nombre}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n\r\n      {/* Lista de trabajos con detalles */}\r\n      <div className=\"mt-4\">\r\n        {trabajos.map((trabajo) => (\r\n          <div key={trabajo.id} className=\"border-b py-2\">\r\n            <p className=\"font-bold text-gray-700\">{trabajo.nombre_trabajo}</p>\r\n            <p>ðŸ”¹ Unidades a Instalar: {trabajo.unidades_a_instalar}</p>\r\n            <p>ðŸ”¹ Precio por Unidad: Q{trabajo.precio_unitario.toFixed(2)}</p>\r\n            <p>ðŸ”¹ Total a Instalar: Q{trabajo.total_a_instalar.toFixed(2)}</p>\r\n            <p>ðŸ”¹ Unidades Instaladas: {trabajo.unidades_instaladas}</p>\r\n            <p>ðŸ”¹ Total Instalado: Q{trabajo.total_instalado.toFixed(2)}</p>\r\n          </div>\r\n        ))}\r\n        {trabajos.length === 0 && proyectoSeleccionado && (\r\n          <p className=\"mt-4 text-gray-500\">No hay trabajos asociados a este proyecto.</p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}