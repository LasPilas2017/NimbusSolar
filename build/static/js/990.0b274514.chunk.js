"use strict";(self.webpackChunknimbus_login_app=self.webpackChunknimbus_login_app||[]).push([[990],{990:(e,a,r)=>{r.r(a),r.d(a,{default:()=>d});var o=r(9379),t=r(5043),s=r(7950),n=r(3960),l=r(3829),i=r(579);function d(e){let{usuario:a}=e;const[r,d]=(0,t.useState)(""),[c,p]=(0,t.useState)("idle"),[u,m]=(0,t.useState)({open:!1,title:"",message:"",tone:"neutral"}),[f,x]=(0,t.useState)({nombre:"",salarioQuincena:"",bonificacion:"",horaExtra:"",viaticos_diarios:"",fechaIngreso:"",dpi:"",telefono:"",fotoPapeleria:null}),g="undefined"!==typeof document?document.body:null,h=e=>String(e||"").replace(/\D/g,""),b=e=>String(e||"").replace(/\D/g,""),j=e=>{const a=h(e).slice(0,13);return[a.slice(0,4),a.slice(4,9),a.slice(9,13)].filter(Boolean).join("-")},v=e=>b(e).slice(0,8).replace(/(\d{4})(\d+)/,"$1-$2"),y=function(e,a){m({open:!0,title:e,message:a,tone:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"neutral"})},N=()=>{m(e=>(0,o.A)((0,o.A)({},e),{},{open:!1}))};(0,t.useEffect)(()=>{const e=h(f.dpi);if(!e)return void p("idle");p("checking");const a=setTimeout(async()=>{const{data:a,error:r}=await n.default.from("registrodepersonal").select("id").eq("dpi",e).limit(1);if(r)return void p("idle");const o=Array.isArray(a)&&a.length>0;p(o?"exists":"available")},500);return()=>clearTimeout(a)},[f.dpi]);const C=e=>{const{name:a,value:r}=e.target;x("dpi"!==a?"telefono"!==a?e=>(0,o.A)((0,o.A)({},e),{},{[a]:r}):e=>(0,o.A)((0,o.A)({},e),{},{[a]:v(r)}):e=>(0,o.A)((0,o.A)({},e),{},{[a]:j(r)}))};return(0,i.jsxs)("div",{className:"bg-white/60 p-6 rounded-xl shadow-md max-w-3xl mx-auto mt-6",children:[(0,i.jsx)("h2",{className:"text-xl font-bold mb-2 text-center text-gray-800",children:"\ud83d\udcdd Registro de Personal"}),r?(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[(0,i.jsx)("input",{type:"text",placeholder:"Nombre completo",name:"nombre",value:f.nombre,onChange:C,autoComplete:"off",className:"border p-2 rounded"}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("input",{type:"text",placeholder:"No. DPI",name:"dpi",value:f.dpi,onChange:C,autoComplete:"off",className:"border p-2 pr-10 rounded w-full ".concat("available"===c?"border-green-500":"exists"===c?"border-red-500":"")}),(0,i.jsxs)("div",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2 text-xs",children:["checking"===c&&(0,i.jsx)("span",{className:"inline-block h-4 w-4 animate-spin rounded-full border-2 border-slate-300 border-t-slate-600"}),"available"===c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"text-green-600",children:"DPI disponible"}),(0,i.jsx)("span",{className:"text-green-600",children:"\u2713"})]}),"exists"===c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"text-red-600",children:"DPI ya registrado"}),(0,i.jsx)("span",{className:"text-red-600",children:"\u2715"})]})]})]}),(0,i.jsx)("input",{type:"number",placeholder:"fijo"===r?"Salario por quincena":"Salario por d\xeda",name:"salarioQuincena",value:f.salarioQuincena,onChange:C,autoComplete:"off",className:"border p-2 rounded"}),"fijo"===r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{type:"number",placeholder:"Bono por d\xeda trabajado",name:"bonificacion",value:f.bonificacion,onChange:C,autoComplete:"off",className:"border p-2 rounded"}),(0,i.jsx)("input",{type:"number",placeholder:"Vi\xe1ticos",name:"viaticos_diarios",value:f.viaticos_diarios,onChange:C,autoComplete:"off",className:"border p-2 rounded"})]}),(0,i.jsx)("input",{type:"number",placeholder:"Pago por hora extra",name:"horaExtra",value:f.horaExtra,onChange:C,autoComplete:"off",className:"border p-2 rounded"}),(0,i.jsx)("input",{type:"date",name:"fechaIngreso",value:f.fechaIngreso,onChange:C,autoComplete:"off",className:"border p-2 rounded"}),(0,i.jsx)("input",{type:"text",placeholder:"Tel\xe9fono",name:"telefono",value:f.telefono,onChange:C,autoComplete:"off",className:"border p-2 rounded"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Papeler\xeda"}),(0,i.jsx)("input",{type:"file",onChange:e=>{x(a=>(0,o.A)((0,o.A)({},a),{},{fotoPapeleria:e.target.files[0]}))},autoComplete:"off",className:"border p-2 rounded w-full"})]}),(0,i.jsxs)("div",{className:"flex justify-between mt-6 col-span-full",children:[(0,i.jsx)("button",{onClick:()=>d(""),className:"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition",children:"Volver"}),(0,i.jsx)("button",{onClick:async()=>{if(!f.nombre.trim()||!r)return void y("Faltan datos","Completa el nombre y selecciona el tipo de personal.","error");if(!h(f.dpi))return void y("Faltan datos","Por favor, ingresa el DPI del trabajador.","error");let e=null;if(f.fotoPapeleria){const a=f.fotoPapeleria,r="".concat(Date.now(),"_").concat(a.name),{error:o}=await n.default.storage.from("papeleria").upload(r,a);if(o)return console.error(o),void y("Error al subir archivo",o.message||"No se pudo subir la papeleria.","error");const{data:{publicUrl:t}}=n.default.storage.from("papeleria").getPublicUrl(r);e=t}const t=(0,o.A)({nombrecompleto:f.nombre.trim(),modalidad:r,salariopordia:"temporal"===r?parseFloat(f.salarioQuincena||0):null,salarioporquincena:"fijo"===r?parseFloat(f.salarioQuincena||0):null,bonificacion:"fijo"===r?parseFloat(f.bonificacion||0):null,pagoporhoraextra:parseFloat(f.horaExtra||0),viaticos_diarios:"fijo"===r?parseFloat(f.viaticos_diarios||0):null,fechadeingreso:f.fechaIngreso||(new Date).toISOString().slice(0,10),dpi:h(f.dpi),telefono:b(f.telefono)},e?{urlpapeleria:e}:{}),{data:s,error:i}=await n.default.from("registrodepersonal").select("id").eq("dpi",t.dpi).limit(1);if(i)return console.error(i),void y("Error al validar DPI",i.message||"Ocurrio un error al validar el DPI.","error");if(Array.isArray(s)&&s.length>0)return void y("DPI ya registrado","Ese DPI ya existe. No se puede registrar otra persona con el mismo DPI.","error");const{error:c}=await n.default.from("registrodepersonal").insert([t]);c?(console.error(c),y("Error al guardar",c.message||"Ocurrio un error al guardar el personal.","error")):(y("Personal agregado","El personal fue agregado correctamente.","success"),await(0,l.F)(a,"Registro de nuevo personal","Se agreg\xf3 al trabajador: ".concat(f.nombre)),x({nombre:"",salarioQuincena:"",bonificacion:"",horaExtra:"",viaticos_diarios:"",fechaIngreso:"",dpi:"",telefono:"",fotoPapeleria:null}),d(""))},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition",children:"Guardar personal"})]})]}):(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("p",{className:"text-gray-700 font-medium mb-4",children:"\xbfQu\xe9 tipo de personal deseas registrar?"}),(0,i.jsxs)("div",{className:"flex justify-center gap-6",children:[(0,i.jsx)("button",{onClick:()=>d("fijo"),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition",children:"Personal Fijo"}),(0,i.jsx)("button",{onClick:()=>d("temporal"),className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition",children:"Personal Temporal"})]})]}),u.open&&g&&(0,s.createPortal)((0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 px-4 py-6",children:(0,i.jsxs)("div",{className:"w-full max-w-md rounded-2xl border border-slate-200 bg-white p-6 shadow-lg",children:[(0,i.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-slate-900",children:u.title}),(0,i.jsx)("p",{className:"mt-2 text-sm ".concat("success"===u.tone?"text-emerald-600":"error"===u.tone?"text-red-600":"text-slate-600"),children:u.message})]}),(0,i.jsx)("button",{type:"button",className:"text-sm font-medium text-slate-500 hover:text-slate-700",onClick:N,children:"Cerrar"})]}),(0,i.jsx)("div",{className:"mt-6 flex justify-end",children:(0,i.jsx)("button",{type:"button",className:"rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-slate-800",onClick:N,children:"Aceptar"})})]})}),g)]})}}}]);
//# sourceMappingURL=990.0b274514.chunk.js.map