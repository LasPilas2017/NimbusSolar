"use strict";(self.webpackChunknimbus_login_app=self.webpackChunknimbus_login_app||[]).push([[276],{276:(e,a,r)=>{r.r(a),r.d(a,{default:()=>l});var t=r(5043),s=r(3960),o=r(3829),i=r(579);function l(e){let{usuario:a,onCerrar:r}=e;const[l,n]=(0,t.useState)(null),[d,c]=(0,t.useState)(!0),[u,m]=(0,t.useState)(!1),[x,b]=(0,t.useState)(null),[p,g]=(0,t.useState)(0),[h,f]=(0,t.useState)(""),[v,w]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{const{data:e,error:r}=await s.default.from("registrodepersonal").select("nombrecompleto, bonificacion, viaticos_diarios").eq("id_usuario",a.id);if(e&&e.length>0){n(e[0]);const r=(new Date).toISOString().slice(0,10),{data:t}=await s.default.from("reportesdiarios").select("id, hora_salida").eq("id_usuario",a.id).eq("fechareporte",r);if(t&&t.length>0){const e=t[0];e.hora_salida?w(!0):(b(e.id),c(!1))}}else console.error(r||"No se encontr\xf3 el supervisor en registrodepersonal")})()},[a]);const j=()=>new Promise(e=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{const{latitude:r,longitude:t}=a.coords;e("Lat: ".concat(r,", Lng: ").concat(t))},()=>{e("No disponible")}):e("No disponible")}),N=()=>{r&&r()};return v?(0,i.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow-md w-full max-w-md mx-auto",children:[(0,i.jsx)("h3",{className:"text-xl font-bold text-purple-800 mb-4",children:"\ud83d\udcdd Reportar Asistencia"}),(0,i.jsx)("p",{className:"text-gray-500 mb-4",children:"\u2705 Asistencia completada hoy. Vuelve ma\xf1ana."}),(0,i.jsx)("button",{onClick:N,className:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 transition",children:"Cerrar"})]}):(0,i.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow-md w-full max-w-md mx-auto",children:[(0,i.jsx)("h3",{className:"text-xl font-bold text-purple-800 mb-4",children:"\ud83d\udcdd Reportar Asistencia"}),l?(0,i.jsxs)("div",{className:"grid gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Nombre"}),(0,i.jsx)("input",{type:"text",value:l.nombrecompleto,disabled:!0,className:"border p-2 rounded w-full bg-gray-100"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Bono diario"}),(0,i.jsx)("input",{type:"number",value:l.bonificacion,disabled:!0,className:"border p-2 rounded w-full bg-gray-100"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Vi\xe1ticos diarios"}),(0,i.jsx)("input",{type:"number",value:l.viaticos_diarios,disabled:!0,className:"border p-2 rounded w-full bg-gray-100"})]}),!d&&(0,i.jsxs)("div",{className:"grid gap-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Horas extras"}),(0,i.jsx)("input",{type:"number",value:p,onChange:e=>g(Number(e.target.value)),disabled:"supervisor"!==a.rol,className:"border p-2 rounded w-full"})]}),p>0&&(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Raz\xf3n de horas extras"}),(0,i.jsx)("input",{type:"text",value:h,onChange:e=>f(e.target.value),disabled:"supervisor"!==a.rol,className:"border p-2 rounded w-full"})]})]}),(0,i.jsxs)("div",{className:"flex gap-4 mt-4",children:[(0,i.jsx)("button",{onClick:d?async()=>{m(!0);const e=await j(),r={nombretrabajador:l.nombrecompleto,bono:l.bonificacion,viaticos_diarios:l.viaticos_diarios,horas_extras:0,fechareporte:(new Date).toISOString().slice(0,10),hora_entrada:(new Date).toLocaleTimeString(),ubicacion_entrada:e,reportadopor:a.usuario,id_usuario:a.id},{data:t,error:i}=await s.default.from("reportesdiarios").insert([r]).select();!i&&t&&t.length>0?(alert("Entrada registrada \u2705"),b(t[0].id),c(!1),await(0,o.F)(a,"Registro de entrada","Entrada registrada para ".concat(l.nombrecompleto))):(console.error(i),alert("Hubo un error al guardar la entrada")),m(!1)}:async()=>{if(!x)return void alert("No se encontr\xf3 el reporte para registrar la salida");if(p>0&&""===h.trim())return void alert("Por favor, ingresa la raz\xf3n de las horas extras");m(!0);const e=await j(),{error:r}=await s.default.from("reportesdiarios").update({hora_salida:(new Date).toLocaleTimeString(),ubicacion_salida:e,horas_extras:p,razon_horas_extras:p>0?h:null}).eq("id",x);r?(console.error(r),alert("Hubo un error al registrar la salida")):(alert("Salida registrada \u2705"),c(!0),b(null),g(0),f(""),w(!0),await(0,o.F)(a,"Registro de salida","Salida registrada para ".concat(l.nombrecompleto," (Horas extras: ").concat(p,")"))),m(!1)},disabled:u,className:"flex-1 ".concat(d?"bg-green-600":"bg-red-600"," text-white py-2 rounded hover:opacity-90"),children:u?"Guardando...":d?"Entrada":"Salida"}),(0,i.jsx)("button",{onClick:N,className:"flex-1 bg-gray-400 text-white py-2 rounded hover:bg-gray-500 transition",children:"Cerrar"})]})]}):(0,i.jsx)("p",{className:"text-gray-500",children:"Cargando datos..."})]})}}}]);
//# sourceMappingURL=276.f41b8e7b.chunk.js.map