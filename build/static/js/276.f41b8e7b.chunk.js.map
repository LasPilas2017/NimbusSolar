{"version":3,"file":"static/js/276.f41b8e7b.chunk.js","mappings":"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","sources":["modules/Personal/ReportarAsistencia.jsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport supabase from \"../../supabase\";\r\nimport { guardarLog } from \"../../utils\";\r\nexport default function ReportarAsistencia({ usuario, onCerrar }) {\r\n  const [datosSupervisor, setDatosSupervisor] = useState(null);\r\n  const [modoEntrada, setModoEntrada] = useState(true); // true = Entrada, false = Salida\r\n  const [guardando, setGuardando] = useState(false);\r\n  const [reporteId, setReporteId] = useState(null);\r\n  const [horasExtras, setHorasExtras] = useState(0);\r\n  const [razonHorasExtras, setRazonHorasExtras] = useState(\"\");\r\n  const [formularioBloqueado, setFormularioBloqueado] = useState(false);\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    const cargarDatos = async () => {\r\n      const { data: supervisorData, error } = await supabase\r\n        .from(\"registrodepersonal\")\r\n        .select(\"nombrecompleto, bonificacion, viaticos_diarios\")\r\n        .eq(\"id_usuario\", usuario.id);\r\n\r\n      if (supervisorData && supervisorData.length > 0) {\r\n        setDatosSupervisor(supervisorData[0]);\r\n\r\n        const hoy = new Date().toISOString().slice(0, 10);\r\n        const { data: reportesHoy } = await supabase\r\n          .from(\"reportesdiarios\")\r\n          .select(\"id, hora_salida\")\r\n          .eq(\"id_usuario\", usuario.id)\r\n          .eq(\"fechareporte\", hoy);\r\n\r\n        if (reportesHoy && reportesHoy.length > 0) {\r\n          const reporte = reportesHoy[0];\r\n          if (reporte.hora_salida) {\r\n            setFormularioBloqueado(true);\r\n          } else {\r\n            setReporteId(reporte.id);\r\n            setModoEntrada(false);\r\n          }\r\n        }\r\n      } else {\r\n        console.error(error || \"No se encontr√≥ el supervisor en registrodepersonal\");\r\n      }\r\n    };\r\n\r\n    cargarDatos();\r\n  }, [usuario]);\r\n\r\n  const obtenerUbicacion = () => {\r\n    return new Promise((resolve) => {\r\n      if (!navigator.geolocation) {\r\n        resolve(\"No disponible\");\r\n      } else {\r\n        navigator.geolocation.getCurrentPosition(\r\n          (pos) => {\r\n            const { latitude, longitude } = pos.coords;\r\n            resolve(`Lat: ${latitude}, Lng: ${longitude}`);\r\n          },\r\n          () => {\r\n            resolve(\"No disponible\");\r\n          }\r\n        );\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleEntrada = async () => {\r\n  setGuardando(true);\r\n  const ubicacion = await obtenerUbicacion();\r\n\r\n  const nuevoReporte = {\r\n    nombretrabajador: datosSupervisor.nombrecompleto,\r\n    bono: datosSupervisor.bonificacion,\r\n    viaticos_diarios: datosSupervisor.viaticos_diarios,\r\n    horas_extras: 0,\r\n    fechareporte: new Date().toISOString().slice(0, 10),\r\n    hora_entrada: new Date().toLocaleTimeString(),\r\n    ubicacion_entrada: ubicacion,\r\n    reportadopor: usuario.usuario,\r\n    id_usuario: usuario.id,\r\n  };\r\n\r\n  const { data, error } = await supabase.from(\"reportesdiarios\").insert([nuevoReporte]).select();\r\n\r\n  if (!error && data && data.length > 0) {\r\n    alert(\"Entrada registrada ‚úÖ\");\r\n    setReporteId(data[0].id);\r\n    setModoEntrada(false);\r\n\r\n    // ‚úÖ Guardar log de entrada\r\n    await guardarLog(\r\n      usuario,\r\n      \"Registro de entrada\",\r\n      `Entrada registrada para ${datosSupervisor.nombrecompleto}`\r\n    );\r\n  } else {\r\n    console.error(error);\r\n    alert(\"Hubo un error al guardar la entrada\");\r\n  }\r\n\r\n  setGuardando(false);\r\n};\r\n\r\nconst handleSalida = async () => {\r\n  if (!reporteId) {\r\n    alert(\"No se encontr√≥ el reporte para registrar la salida\");\r\n    return;\r\n  }\r\n\r\n  // Validar que si hay horas extras, se ingrese la raz√≥n\r\n  if (horasExtras > 0 && razonHorasExtras.trim() === \"\") {\r\n    alert(\"Por favor, ingresa la raz√≥n de las horas extras\");\r\n    return;\r\n  }\r\n\r\n  setGuardando(true);\r\n  const ubicacion = await obtenerUbicacion();\r\n\r\n  const { error } = await supabase\r\n    .from(\"reportesdiarios\")\r\n    .update({\r\n      hora_salida: new Date().toLocaleTimeString(),\r\n      ubicacion_salida: ubicacion,\r\n      horas_extras: horasExtras,\r\n      razon_horas_extras: horasExtras > 0 ? razonHorasExtras : null,\r\n    })\r\n    .eq(\"id\", reporteId);\r\n\r\n  if (!error) {\r\n    alert(\"Salida registrada ‚úÖ\");\r\n    setModoEntrada(true);\r\n    setReporteId(null);\r\n    setHorasExtras(0);\r\n    setRazonHorasExtras(\"\");\r\n    setFormularioBloqueado(true);\r\n\r\n    // ‚úÖ Guardar log de salida\r\n    await guardarLog(\r\n      usuario,\r\n      \"Registro de salida\",\r\n      `Salida registrada para ${datosSupervisor.nombrecompleto} (Horas extras: ${horasExtras})`\r\n    );\r\n  } else {\r\n    console.error(error);\r\n    alert(\"Hubo un error al registrar la salida\");\r\n  }\r\n\r\n  setGuardando(false);\r\n};\r\n\r\n\r\n  const cerrarFormulario = () => {\r\n    if (onCerrar) {\r\n      onCerrar();\r\n    }\r\n  };\r\n\r\n  // Si el formulario est√° bloqueado (ya hizo entrada y salida)\r\n  if (formularioBloqueado) {\r\n    return (\r\n      <div className=\"bg-white p-4 rounded-xl shadow-md w-full max-w-md mx-auto\">\r\n        <h3 className=\"text-xl font-bold text-purple-800 mb-4\">üìù Reportar Asistencia</h3>\r\n        <p className=\"text-gray-500 mb-4\">‚úÖ Asistencia completada hoy. Vuelve ma√±ana.</p>\r\n        <button\r\n          onClick={cerrarFormulario}\r\n          className=\"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500 transition\"\r\n        >\r\n          Cerrar\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"bg-white p-4 rounded-xl shadow-md w-full max-w-md mx-auto\">\r\n      <h3 className=\"text-xl font-bold text-purple-800 mb-4\">üìù Reportar Asistencia</h3>\r\n\r\n      {datosSupervisor ? (\r\n        <div className=\"grid gap-4\">\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700\">Nombre</label>\r\n            <input\r\n              type=\"text\"\r\n              value={datosSupervisor.nombrecompleto}\r\n              disabled\r\n              className=\"border p-2 rounded w-full bg-gray-100\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700\">Bono diario</label>\r\n            <input\r\n              type=\"number\"\r\n              value={datosSupervisor.bonificacion}\r\n              disabled\r\n              className=\"border p-2 rounded w-full bg-gray-100\"\r\n            />\r\n          </div>\r\n\r\n          <div>\r\n            <label className=\"block text-sm font-medium text-gray-700\">Vi√°ticos diarios</label>\r\n            <input\r\n              type=\"number\"\r\n              value={datosSupervisor.viaticos_diarios}\r\n              disabled\r\n              className=\"border p-2 rounded w-full bg-gray-100\"\r\n            />\r\n          </div>\r\n\r\n          {!modoEntrada && (\r\n            <div className=\"grid gap-2\">\r\n              <div>\r\n                <label className=\"block text-sm font-medium text-gray-700\">Horas extras</label>\r\n                <input\r\n                  type=\"number\"\r\n                  value={horasExtras}\r\n                  onChange={(e) => setHorasExtras(Number(e.target.value))}\r\n                  disabled={usuario.rol !== \"supervisor\"}\r\n                  className=\"border p-2 rounded w-full\"\r\n                />\r\n              </div>\r\n\r\n              {horasExtras > 0 && (\r\n                <div>\r\n                  <label className=\"block text-sm font-medium text-gray-700\">Raz√≥n de horas extras</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={razonHorasExtras}\r\n                    onChange={(e) => setRazonHorasExtras(e.target.value)}\r\n                    disabled={usuario.rol !== \"supervisor\"}\r\n                    className=\"border p-2 rounded w-full\"\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"flex gap-4 mt-4\">\r\n            <button\r\n              onClick={modoEntrada ? handleEntrada : handleSalida}\r\n              disabled={guardando}\r\n              className={`flex-1 ${\r\n                modoEntrada ? \"bg-green-600\" : \"bg-red-600\"\r\n              } text-white py-2 rounded hover:opacity-90`}\r\n            >\r\n              {guardando\r\n                ? \"Guardando...\"\r\n                : modoEntrada\r\n                ? \"Entrada\"\r\n                : \"Salida\"}\r\n            </button>\r\n\r\n            <button\r\n              onClick={cerrarFormulario}\r\n              className=\"flex-1 bg-gray-400 text-white py-2 rounded hover:bg-gray-500 transition\"\r\n            >\r\n              Cerrar\r\n            </button>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <p className=\"text-gray-500\">Cargando datos...</p>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":["ReportarAsistencia","_ref","usuario","onCerrar","datosSupervisor","setDatosSupervisor","useState","modoEntrada","setModoEntrada","guardando","setGuardando","reporteId","setReporteId","horasExtras","setHorasExtras","razonHorasExtras","setRazonHorasExtras","formularioBloqueado","setFormularioBloqueado","useEffect","async","data","supervisorData","error","supabase","from","select","eq","id","length","hoy","Date","toISOString","slice","reportesHoy","reporte","hora_salida","console","cargarDatos","obtenerUbicacion","Promise","resolve","navigator","geolocation","getCurrentPosition","pos","latitude","longitude","coords","concat","cerrarFormulario","_jsxs","className","children","_jsx","onClick","type","value","nombrecompleto","disabled","bonificacion","viaticos_diarios","onChange","e","Number","target","rol","ubicacion","nuevoReporte","nombretrabajador","bono","horas_extras","fechareporte","hora_entrada","toLocaleTimeString","ubicacion_entrada","reportadopor","id_usuario","insert","alert","guardarLog","trim","update","ubicacion_salida","razon_horas_extras"],"sourceRoot":""}