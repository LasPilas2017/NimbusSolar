/*! For license information please see 981.dfff5996.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunknimbus_login_app=self.webpackChunknimbus_login_app||[]).push([[849,981],{4849:(a,e,r)=>{r.r(e),r.d(e,{default:()=>l});var o=r(9379),s=r(5043),t=r(3960),i=r(3829),d=r(579);function l(a){let{usuario:e,persona:r,onCerrar:l,onRecargar:n}=a;const[c,p]=(0,s.useState)({salarioBase:"",bonoAsistencia:"",viaticos:"",pagoHoraExtra:"",salarioDia:""});(0,s.useEffect)(()=>{"fijo"===r.modalidad?p({salarioBase:r.salarioporquincena||"",bonoAsistencia:r.bonificacion||"",viaticos:r.viaticos_diarios||"",pagoHoraExtra:r.pagoporhoraextra||""}):"temporal"===r.modalidad&&p({salarioDia:r.salariopordia||"",pagoHoraExtra:r.pagoporhoraextra||""})},[r]);const x=a=>{const{name:e,value:r}=a.target;p(a=>(0,o.A)((0,o.A)({},a),{},{[e]:r}))};return(0,d.jsxs)("div",{className:"p-4 rounded-xl shadow bg-white",children:[(0,d.jsx)("h3",{className:"font-semibold text-lg mb-4",children:"\u2699\ufe0f Modificar Datos de Trabajo"}),"fijo"===r.modalidad&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block font-medium mb-1",children:"Salario por quincena (Q)"}),(0,d.jsx)("input",{type:"number",name:"salarioBase",value:c.salarioBase,onChange:x,className:"border p-2 rounded w-full"})]}),(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block font-medium mb-1",children:"Bono por d\xeda trabajado (Q)"}),(0,d.jsx)("input",{type:"number",name:"bonoAsistencia",value:c.bonoAsistencia,onChange:x,className:"border p-2 rounded w-full"})]}),(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block font-medium mb-1",children:"Vi\xe1ticos diarios (Q)"}),(0,d.jsx)("input",{type:"number",name:"viaticos",value:c.viaticos,onChange:x,className:"border p-2 rounded w-full"})]}),(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block font-medium mb-1",children:"Pago por hora extra (Q)"}),(0,d.jsx)("input",{type:"number",name:"pagoHoraExtra",value:c.pagoHoraExtra,onChange:x,className:"border p-2 rounded w-full"})]})]}),"temporal"===r.modalidad&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block font-medium mb-1",children:"Salario por d\xeda (Q)"}),(0,d.jsx)("input",{type:"number",name:"salarioDia",value:c.salarioDia,onChange:x,className:"border p-2 rounded w-full"})]}),(0,d.jsxs)("div",{className:"mb-4",children:[(0,d.jsx)("label",{className:"block font-medium mb-1",children:"Pago por hora extra (Q)"}),(0,d.jsx)("input",{type:"number",name:"pagoHoraExtra",value:c.pagoHoraExtra,onChange:x,className:"border p-2 rounded w-full"})]})]}),(0,d.jsxs)("div",{className:"flex gap-4 justify-center mt-4",children:[(0,d.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded shadow hover:bg-green-700",onClick:async()=>{let a={};"fijo"===r.modalidad?a={salarioporquincena:c.salarioBase||null,bonificacion:c.bonoAsistencia||null,viaticos_diarios:c.viaticos||null,horas_extras:c.pagoHoraExtra||null}:"temporal"===r.modalidad&&(a={salariopordia:c.salarioDia||null,horas_extras:c.pagoHoraExtra||null});const{error:o}=await t.default.from("registrodepersonal").update(a).eq("id",r.id);o?(console.error("Error al actualizar:",o),alert("Ocurri\xf3 un error al actualizar los datos.")):(alert("Datos actualizados correctamente."),await(0,i.F)(e,"Modificaci\xf3n de datos de trabajo","El usuario modific\xf3 datos de: ".concat(r.nombrecompleto)),n&&n(),l())},children:"Guardar"}),(0,d.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded shadow hover:bg-red-700",onClick:l,children:"Cerrar"})]})]})}},9981:(a,e,r)=>{r.r(e),r.d(e,{default:()=>x});var o=r(9379),s=r(5043),t=r(7784);const i=(0,t.A)("circle-minus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]),d=(0,t.A)("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var l=r(3960),n=r(4849),c=r(3829),p=r(579);function x(a){let{usuario:e}=a;const[r,t]=(0,s.useState)(!1),[x,m]=(0,s.useState)([]),[b,u]=(0,s.useState)(null),[h,g]=(0,s.useState)(!1),[j,f]=(0,s.useState)(!1),[N,v]=(0,s.useState)(!1),[y,w]=(0,s.useState)(""),[E,F]=(0,s.useState)(null),[k,S]=(0,s.useState)([]),[C,_]=(0,s.useState)([]),[Q,B]=(0,s.useState)({pagoPorDia:"",horasExtras:"",unidadesMeta:"",unidadesBonificacion:"",bonificacionExtra:"",pagoExtraordinario:"",grupo:""}),[M,z]=(0,s.useState)(!1),I=a=>{B((0,o.A)((0,o.A)({},Q),{},{[a.target.name]:a.target.value}))},A=async a=>{const{data:e,error:r}=await l.default.from("reportesdiarios").select("*").eq("nombretrabajador",a);r?console.error("Error cargando reportes diarios:",r):S(e)},D=async a=>{if(!a)return void _([]);const{data:e,error:r}=await l.default.from("proyectos_trabajos").select("id, nombre_trabajo").eq("proyecto_id",a);r?console.error("Error al cargar trabajos:",r):(console.log("Trabajos obtenidos:",e),_(e))},R=async()=>{const{data:a,error:r}=await l.default.from("registrodepersonal").select("*");if(r)return void console.error("Error cargando personal:",r);await(0,c.F)(e,"Vista de Planilla","El usuario visualiz\xf3 la planilla de personal.");const{data:s,error:t}=await l.default.from("reportesdiarios").select("nombretrabajador, pagototal, viaticos");if(t)return void console.error("Error cargando reportes:",t);const i={};s.forEach(a=>{i[a.nombretrabajador]||(i[a.nombretrabajador]={pagos:0,viaticos:0}),i[a.nombretrabajador].pagos+=parseFloat(a.pagototal||0),i[a.nombretrabajador].viaticos+=parseFloat(a.viaticos||0)});const d=a.map(a=>{const e=i[a.nombrecompleto]||{pagos:0,viaticos:0};let r=0;return r="fijo"===a.modalidad?(a.salarioporquincena||0)+e.pagos:e.pagos,(0,o.A)((0,o.A)({},a),{},{totalAcumulado:r,totalViaticos:e.viaticos})});m(d)};return(0,s.useEffect)(()=>{R()},[]),(0,p.jsxs)("div",{className:"overflow-x-auto bg-white/70 backdrop-blur-md p-4 md:p-6 rounded-xl shadow-xl mt-6",children:[(0,p.jsx)("h3",{className:"text-xl font-bold mb-4 text-gray-800 text-center md:text-left",children:"\ud83d\udccb Planilla de Personal"}),(0,p.jsxs)("table",{className:"min-w-full border border-gray-300 text-sm text-center",children:[(0,p.jsx)("thead",{className:"bg-gray-200 text-gray-700",children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{className:"px-2 py-2 border"}),(0,p.jsx)("th",{className:"px-2 py-2 border",children:"Nombre"}),(0,p.jsx)("th",{className:"px-2 py-2 border",children:"Modalidad"}),(0,p.jsx)("th",{className:"px-2 py-2 border",children:"Salario"}),(0,p.jsx)("th",{className:"px-2 py-2 border",children:"Bono por d\xeda"}),(0,p.jsx)("th",{className:"px-2 py-2 border",children:"Hora extra"}),(0,p.jsx)("th",{className:"px-2 py-2 border",children:"Vi\xe1ticos"}),(0,p.jsx)("th",{className:"px-2 py-2 border",children:"Total Vi\xe1ticos"}),(0,p.jsx)("th",{className:"px-2 py-2 border font-semibold text-green-800",children:"Total"})]})}),(0,p.jsx)("tbody",{children:x.map(a=>{const e="fijo"===a.modalidad?a.salarioporquincena||0:a.salariopordia||0,c=a.bonificacion||0,x=a.pagoporhoraextra||0,m=a.viaticos_diarios||0,S=(a.totalAcumulado||0)-(a.totalViaticos||0);return(0,p.jsxs)(s.Fragment,{children:[(0,p.jsxs)("tr",{className:"border-b",children:[(0,p.jsx)("td",{className:"px-2 py-2 border",children:(0,p.jsx)("button",{onClick:()=>(async a=>{if((null===b||void 0===b?void 0:b.id)===a.id&&h)g(!1),u(null);else{u(a),g(!0),f(!1),v(!1),w(""),B({pagoPorDia:"",horasExtras:"",unidadesMeta:"",unidadesBonificacion:"",bonificacionExtra:"",pagoExtraordinario:"",grupo:"",trabajoRealizado:""}),await A(a.nombrecompleto);const{data:e,error:r}=await l.default.from("proyectos_personal").select("proyecto_id").eq("trabajador_id",a.id).limit(1);if(r)return void console.error("Error buscando proyecto:",r);if(e&&e.length>0){const a=e[0].proyecto_id;console.log("Proyecto encontrado:",a),F({id:a}),await D(a)}else alert("Error: No se encontr\xf3 el proyecto asignado para este trabajador. Verifica la asignaci\xf3n."),_([]),F(null)}})(a),className:"text-green-600 hover:text-green-800",children:(null===b||void 0===b?void 0:b.id)===a.id&&h?(0,p.jsx)(i,{size:20}):(0,p.jsx)(d,{size:20})})}),(0,p.jsx)("td",{className:"px-2 py-2 border text-xs md:text-sm",children:a.nombrecompleto}),(0,p.jsx)("td",{className:"px-2 py-2 border capitalize text-xs md:text-sm",children:a.modalidad}),(0,p.jsxs)("td",{className:"px-2 py-2 border text-xs md:text-sm",children:["Q",e.toLocaleString()]}),(0,p.jsxs)("td",{className:"px-2 py-2 border text-xs md:text-sm",children:["Q",c.toLocaleString()]}),(0,p.jsxs)("td",{className:"px-2 py-2 border text-xs md:text-sm",children:["Q",x.toLocaleString()]}),(0,p.jsxs)("td",{className:"px-2 py-2 border text-xs md:text-sm",children:["Q",m.toLocaleString()]}),(0,p.jsxs)("td",{className:"px-2 py-2 border text-xs md:text-sm text-green-700 font-semibold",children:["Q",(a.totalViaticos||0).toLocaleString()]}),(0,p.jsxs)("td",{className:"px-2 py-2 border font-bold text-green-700 text-xs md:text-sm",children:["Q",S.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),h&&(null===b||void 0===b?void 0:b.id)===a.id&&(0,p.jsx)("tr",{children:(0,p.jsx)("td",{colSpan:"8",className:"px-4 py-2 bg-gray-50",children:(0,p.jsxs)("div",{className:"p-4 bg-white rounded-xl shadow",children:[(0,p.jsxs)("h4",{className:"font-bold text-gray-800 mb-4 text-center md:text-left",children:["\ud83d\udcc5 Resumen diario de ",a.nombrecompleto]}),(0,p.jsxs)("div",{className:"flex flex-col md:flex-row justify-center gap-4 mb-4",children:[(0,p.jsx)("div",{onClick:()=>{f(!j),v(!1),t(!r)},className:"bg-blue-600 text-white px-4 py-2 rounded-2xl shadow cursor-pointer hover:bg-blue-700 transition w-full md:w-40 text-center",children:r?"Cerrar modificaci\xf3n":"Modificar trabajos"}),(0,p.jsx)("div",{onClick:()=>{v(!N),f(!1)},className:"bg-green-600 text-white px-4 py-2 rounded-2xl shadow cursor-pointer hover:bg-green-700 transition w-full md:w-40 text-center",children:"Reportar d\xeda"})]}),N&&(0,p.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow text-center md:text-left",children:[(0,p.jsx)("h5",{className:"font-semibold mb-2",children:"\ud83d\udcc6 Reportar asistencia"}),(0,p.jsx)("label",{className:"block mb-1 font-medium",children:"\xbfSe present\xf3?"}),(0,p.jsxs)("select",{value:y,onChange:a=>w(a.target.value),className:"border p-2 rounded mb-2 w-full md:w-40",children:[(0,p.jsx)("option",{value:"",children:"Seleccione"}),(0,p.jsx)("option",{value:"si",children:"S\xed"}),(0,p.jsx)("option",{value:"no",children:"No"})]}),"si"===y&&(0,p.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Trabajo realizado"}),(0,p.jsxs)("select",{name:"trabajoRealizado",value:Q.trabajoRealizado||"",onChange:a=>B((0,o.A)((0,o.A)({},Q),{},{trabajoRealizado:a.target.value})),className:"border p-2 rounded w-full",children:[(0,p.jsx)("option",{value:"",children:"Seleccione un trabajo"}),C.map(a=>(0,p.jsx)("option",{value:a.nombre_trabajo,children:a.nombre_trabajo},a.id))]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Horas extras"}),(0,p.jsxs)("div",{className:"grid grid-cols-3 gap-1",children:[(0,p.jsx)("input",{type:"number",name:"horasExtras",placeholder:"Cantidad",value:Q.horasExtras||"",onChange:I,className:"border p-1 rounded text-xs"}),(0,p.jsx)("input",{type:"text",readOnly:!0,value:"Q".concat(a.pagoporhoraextra||0),className:"border p-1 rounded bg-gray-100 text-xs cursor-not-allowed"}),(0,p.jsx)("input",{type:"text",readOnly:!0,value:"Q".concat((parseFloat(Q.horasExtras||0)*parseFloat(a.pagoporhoraextra||0)).toFixed(2)),className:"border p-1 rounded bg-green-100 text-green-800 font-bold text-xs"})]})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Vi\xe1ticos"}),(0,p.jsx)("input",{type:"text",value:"Q".concat(a.viaticos_diarios||0),readOnly:!0,className:"border p-2 rounded bg-gray-100 cursor-not-allowed w-full"})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Unidades para meta"}),(0,p.jsx)("input",{type:"number",name:"unidadesMeta",placeholder:"Unidades para meta",value:Q.unidadesMeta,onChange:I,className:"border p-2 rounded w-full ".concat(""===Q.unidadesMeta&&M?"border-red-500":"")})]}),(0,p.jsxs)("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Unidades para bonificaci\xf3n"}),(0,p.jsx)("input",{type:"number",name:"unidadesBonificacion",placeholder:"Unidades para bonificaci\xf3n",value:Q.unidadesBonificacion,onChange:I,className:"border p-2 rounded w-full ".concat(""===Q.unidadesBonificacion&&M?"border-red-500":"")})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Pago Extraordinario (domingo)"}),(0,p.jsx)("input",{type:"number",name:"pagoExtraordinario",placeholder:"Q0",value:Q.pagoExtraordinario||"",onChange:I,className:"border p-2 rounded w-full"})]})]}),parseInt(Q.unidadesBonificacion||0)>parseInt(Q.unidadesMeta||0)&&(0,p.jsxs)("div",{className:"md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Bonificaci\xf3n por unidades extras (Q)"}),(0,p.jsx)("input",{type:"number",name:"bonificacionExtra",placeholder:"Bonificaci\xf3n por unidades extras (Q)",value:Q.bonificacionExtra||"",onChange:I,className:"border p-2 rounded w-full ".concat(""===Q.bonificacionExtra&&M?"border-red-500":"")})]}),(0,p.jsxs)("div",{children:[(0,p.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Pago de U/Extra"}),(0,p.jsx)("input",{type:"text",readOnly:!0,value:"Q".concat(((parseInt(Q.unidadesBonificacion||0)-parseInt(Q.unidadesMeta||0))*parseFloat(Q.bonificacionExtra||0)).toFixed(2)),className:"border p-2 rounded bg-green-100 text-green-800 font-bold w-full"})]})]}),(0,p.jsxs)("div",{className:"col-span-1 md:col-span-2 bg-green-100 p-2 rounded text-green-800 font-bold",children:["Total: Q",(parseFloat(a.bonificacion||0)+parseFloat(a.viaticos_diarios||0)+parseFloat(Q.horasExtras||0)*parseFloat(a.pagoporhoraextra||0)+(parseInt(Q.unidadesBonificacion||0)-parseInt(Q.unidadesMeta||0))*parseFloat(Q.bonificacionExtra||0)+parseFloat(Q.pagoExtraordinario||0)).toFixed(2)]})]}),"no"===y&&(0,p.jsx)("p",{className:"text-red-600 font-semibold mt-2",children:"No se registrar\xe1n datos adicionales."}),(0,p.jsx)("div",{className:"flex justify-center mt-4",children:(0,p.jsx)("button",{onClick:async()=>{if(["horasExtras","unidadesMeta","unidadesBonificacion","trabajoRealizado"].some(a=>""===Q[a])){if(!window.confirm("Faltan datos. Desea guardar solo los datos llenados?"))return void z(!0);console.log("Guardando reporte parcial...")}if(!E||!E.id)return void alert("Error: No se encontr\xf3 el proyecto asignado para este trabajador. Verifica la asignaci\xf3n.");if(!Q.trabajoRealizado)return void alert("Por favor, selecciona el trabajo realizado.");const e={fechareporte:(new Date).toISOString().slice(0,10),nombretrabajador:b.nombrecompleto,horas_extras:parseFloat(Q.horasExtras||0),bono:parseInt(a.bonificacion||0,10)||0,viaticos:parseInt(a.viaticos_diarios||0,10)||0,metaestablecida:parseInt(Q.unidadesMeta||0),cantidad:parseInt(Q.unidadesBonificacion||0),extra:parseFloat(Q.bonificacionExtra||0),pagoextraordinario:parseFloat(Q.pagoExtraordinario||0),pagototal:parseFloat(a.bonificacion||0)+parseFloat(a.viaticos_diarios||0)+parseFloat(Q.horasExtras||0)*parseFloat(a.pagoporhoraextra||0)+(parseInt(Q.unidadesBonificacion||0)-parseInt(Q.unidadesMeta||0))*parseFloat(Q.bonificacionExtra||0)+parseFloat(Q.pagoExtraordinario||0),numerogrupo:Q.grupo||"",sepresentoatrabajar:y,proyecto:E.id,trabajorealizado:Q.trabajoRealizado};try{const{error:r}=await l.default.from("reportesdiarios").insert([e]);if(r)throw r;alert("\xa1Reporte guardado correctamente!"),v(!1),g(!1),R();const o=parseFloat(a.bonificacion||0)+parseFloat(a.viaticos_diarios||0)+parseFloat(Q.horasExtras||0)*parseFloat(a.pagoporhoraextra||0)+(parseInt(Q.unidadesBonificacion||0)-parseInt(Q.unidadesMeta||0))*parseFloat(Q.bonificacionExtra||0)+parseFloat(Q.pagoExtraordinario||0),s=parseInt(o,10)||0,{error:t}=await l.default.from("registrodepersonal").update({salariopordia:s}).eq("id",a.id);if(t)throw t;R()}catch(r){console.error("Error al guardar en la base de datos:",r),alert("Error al guardar en la base de datos.")}},className:"bg-green-600 text-white px-4 py-2 rounded-2xl shadow hover:bg-green-700 transition",children:"Subir Reporte"})})]}),k.length>0?(0,p.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow mt-4",children:[(0,p.jsx)("h5",{className:"font-semibold text-gray-700 mb-2",children:"\ud83d\udcdd Reportes diarios:"}),(0,p.jsxs)("table",{className:"min-w-full text-xs text-center border border-gray-300",children:[(0,p.jsx)("thead",{className:"bg-gray-200 text-gray-700",children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{className:"px-2 py-1 border",children:"Fecha"}),(0,p.jsx)("th",{className:"px-2 py-1 border",children:"Horas extras (Q)"}),(0,p.jsx)("th",{className:"px-2 py-1 border",children:"Unidades establecidas"}),(0,p.jsx)("th",{className:"px-2 py-1 border",children:"Unidades hechas"}),(0,p.jsx)("th",{className:"px-2 py-1 border",children:"Unidades extras realizadas"}),(0,p.jsx)("th",{className:"px-2 py-1 border",children:"Pago Domingo"}),(0,p.jsx)("th",{className:"px-2 py-1 border",children:"Vi\xe1ticos"}),(0,p.jsx)("th",{className:"px-2 py-1 border font-semibold text-green-800",children:"Pago Total (Q)"})]})}),(0,p.jsx)("tbody",{children:k.map((a,e)=>{const r=(parseFloat(a.horas_extras||0)*parseFloat((null===b||void 0===b?void 0:b.pagoporhoraextra)||0)).toFixed(2),o=parseInt(a.cantidad||0)-parseInt(a.metaestablecida||0);return(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{className:"border px-2 py-1",children:a.fechareporte}),(0,p.jsxs)("td",{className:"border px-2 py-1",children:["Q",r]}),(0,p.jsx)("td",{className:"border px-2 py-1",children:a.metaestablecida}),(0,p.jsx)("td",{className:"border px-2 py-1",children:a.cantidad}),(0,p.jsx)("td",{className:"border px-2 py-1",children:o}),(0,p.jsx)("td",{className:"border px-2 py-1",children:a.pagoextraordinario}),(0,p.jsx)("td",{className:"border px-2 py-1",children:a.viaticos}),(0,p.jsxs)("td",{className:"border px-2 py-1 font-bold text-green-700",children:["Q",parseFloat(a.pagototal).toFixed(2)]})]},e)})})]})]}):(0,p.jsx)("p",{className:"text-gray-500 text-sm italic mt-2",children:"No hay reportes registrados a\xfan."}),"no"===y&&(0,p.jsx)("p",{className:"text-red-600 font-semibold mt-2",children:"No se registrar\xe1n datos adicionales."}),r&&(0,p.jsx)(n.default,{persona:b,onCerrar:()=>t(!1)})]})})})]},a.id)})})]})]})}}}]);
//# sourceMappingURL=981.dfff5996.chunk.js.map